"use strict";(self.webpackChunktechdocs=self.webpackChunktechdocs||[]).push([[7884],{9329:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var s=i(4848),c=i(8453);const o={title:"Nagios"},a=void 0,r={id:"nagios",title:"Nagios",description:"Commands tested on version Core 4.3.",source:"@site/docs/nagios.md",sourceDirName:".",slug:"/nagios",permalink:"/techdocs/docs/nagios",draft:!1,unlisted:!1,editUrl:"https://github.com/lfir/techdocs/edit/devel/docs/nagios.md",tags:[],version:"current",lastUpdatedBy:"Leandro",lastUpdatedAt:1725535040,formattedLastUpdatedAt:"Sep 5, 2024",frontMatter:{title:"Nagios"},sidebar:"defaultSidebar",previous:{title:"Make",permalink:"/techdocs/docs/make"},next:{title:"Networking",permalink:"/techdocs/docs/networking"}},d={},l=[{value:"Check connectivity with nrpe agent",id:"check-connectivity-with-nrpe-agent",level:2},{value:"Check main config file for errors",id:"check-main-config-file-for-errors",level:2},{value:"Nrpe",id:"nrpe",level:2},{value:"Example nrpe checks from nrpe.cfg",id:"example-nrpe-checks-from-nrpecfg",level:3},{value:"Use nrpe",id:"use-nrpe",level:3},{value:"Install from source on SLES 12 SP2",id:"install-from-source-on-sles-12-sp2",level:2},{value:"Enable additional repos, install dependencies",id:"enable-additional-repos-install-dependencies",level:3},{value:"Add to DirectoryIndex section in apache .conf files",id:"add-to-directoryindex-section-in-apache-conf-files",level:3},{value:"Load apache module for php5",id:"load-apache-module-for-php5",level:3},{value:"Configure and compile source",id:"configure-and-compile-source",level:3},{value:"Create user and group",id:"create-user-and-group",level:3},{value:"Install files and enable services",id:"install-files-and-enable-services",level:3},{value:"Set web admin password",id:"set-web-admin-password",level:3},{value:"Start services",id:"start-services",level:3},{value:"Build &amp; install nagios plugins",id:"build--install-nagios-plugins",level:3},{value:"Send email notifications with postfix and a different mail server",id:"send-email-notifications-with-postfix-and-a-different-mail-server",level:2}];function t(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Commands tested on version Core 4.3."})}),"\n",(0,s.jsx)(n.h2,{id:"check-connectivity-with-nrpe-agent",children:"Check connectivity with nrpe agent"}),"\n",(0,s.jsx)(n.p,{children:"From the nagios server."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"/usr/local/nagios/libexec/check_nrpe -H targetHostAddress\n"})}),"\n",(0,s.jsx)(n.h2,{id:"check-main-config-file-for-errors",children:"Check main config file for errors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg\n"})}),"\n",(0,s.jsx)(n.h2,{id:"nrpe",children:"Nrpe"}),"\n",(0,s.jsx)(n.h3,{id:"example-nrpe-checks-from-nrpecfg",children:"Example nrpe checks from nrpe.cfg"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"command[check_ping]=/usr/lib/nagios/plugins/check_ping -H 127.0.0.1 -w 100.0,20% -c 500.0,60%\ncommand[check_ssh]=/usr/lib/nagios/plugins/check_ssh -H 127.0.0.1\ncommand[check_users]=/usr/lib/nagios/plugins/check_users -w 5 -c 10\ncommand[check_load]=/usr/lib/nagios/plugins/check_load -w 15,10,5 -c 30,25,20\ncommand[check_root]=/usr/lib/nagios/plugins/check_disk -w 10% -c 5% -p /\ncommand[check_opt]=/usr/lib/nagios/plugins/check_disk -w 10% -c 5% -p /opt\ncommand[check_var]=/usr/lib/nagios/plugins/check_disk -w 10% -c 5% -p /var\ncommand[check_boot]=/usr/lib/nagios/plugins/check_disk -w 10% -c 5% -p /boot\ncommand[check_swap]=/usr/lib/nagios/plugins/check_swap -w 10% -c 5%\ncommand[check_zombie_procs]=/usr/lib/nagios/plugins/check_procs -w 5 -c 10 -s Z\ncommand[check_total_procs]=/usr/lib/nagios/plugins/check_procs -w 350 -c 500\ncommand[check_http]=/usr/lib/nagios/plugins/check_http -H localhost -w 45 -c 60\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-nrpe",children:"Use nrpe"}),"\n",(0,s.jsxs)(n.p,{children:["Include in ",(0,s.jsx)(n.code,{children:"commands.cfg"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"define command {\n    command_name check_nrpe\n    command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"nrpe"})," package must be installed on the host and the target servers."]})}),"\n",(0,s.jsx)(n.h2,{id:"install-from-source-on-sles-12-sp2",children:"Install from source on SLES 12 SP2"}),"\n",(0,s.jsx)(n.h3,{id:"enable-additional-repos-install-dependencies",children:"Enable additional repos, install dependencies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SUSEConnect -p sle-sdk/12.2/x86_64\nSUSEConnect -p sle-module-web-scripting/12/x86_64\nzypper in autoconf gcc glibc make wget unzip apache2 apache2-utils php5 apache2-mod_php5 gd gd-devel\n"})}),"\n",(0,s.jsx)(n.h3,{id:"add-to-directoryindex-section-in-apache-conf-files",children:"Add to DirectoryIndex section in apache .conf files"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"index.html index.cgi index.pl index.php index.xhtml index.htm\n"})}),"\n",(0,s.jsx)(n.h3,{id:"load-apache-module-for-php5",children:"Load apache module for php5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"a2enmod php5\nsudo systemctl restart apache2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configure-and-compile-source",children:"Configure and compile source"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd /tmp\nwget -O nagioscore.tar.gz https://github.com/NagiosEnterprises/nagioscore/archive/nagios-4.3.2.tar.gz\ntar xzf nagioscore.tar.gz\n\ncd /tmp/nagioscore-nagios-4.3.2/\n./configure --with-httpd-conf=/etc/apache2/vhosts.d\nmake all\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-user-and-group",children:"Create user and group"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"useradd nagios\ngroupadd nagios\nusermod -a -G nagios nagios\nusermod -a -G nagios wwwrun\n"})}),"\n",(0,s.jsx)(n.h3,{id:"install-files-and-enable-services",children:"Install files and enable services"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"make install\nmake install-init\nsystemctl enable nagios\n\nmake install-commandmode\nmake install-config\nmake install-webconf\nsystemctl enable apache2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"set-web-admin-password",children:"Set web admin password"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"htpasswd2 -c /usr/local/nagios/etc/htpasswd.users nagiosadmin\n"})}),"\n",(0,s.jsx)(n.h3,{id:"start-services",children:"Start services"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"systemctl start nagios\n"})}),"\n",(0,s.jsx)(n.h3,{id:"build--install-nagios-plugins",children:"Build & install nagios plugins"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"zypper in autoconf gcc glibc libmcrypt-devel make libopenssl-devel wget gettext gettext-runtime automake net-snmp perl-Net-SNMP\n\nwget --no-check-certificate -O nagios-plugins.tar.gz https://github.com/nagios-plugins/nagios-plugins/archive/release-2.2.1.tar.gz\ntar zxf nagios-plugins.tar.gz\n\ncd /tmp/nagios-plugins-release-2.2.1/\nsudo ./tools/setup\nsudo ./configure\nsudo make\nsudo make install\n"})}),"\n",(0,s.jsx)(n.h2,{id:"send-email-notifications-with-postfix-and-a-different-mail-server",children:"Send email notifications with postfix and a different mail server"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"/etc/postfix/main.cf"})," should contain:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"relayhost = your_smtp_relay_address\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Add to ",(0,s.jsx)(n.code,{children:"commands.cfg"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"'notify-host-by-email' command definition\n'notify-service-by-email' command definition\n"})}),"\n",(0,s.jsx)(n.p,{children:"From address can be added to mail command with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'-r "mail@dir"\n'})})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(6540);const c={},o=s.createContext(c);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);